\documentclass[a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[T2A]{fontenc}
\usepackage{lmodern}
\usepackage[russian,english]{babel}
\usepackage{amsmath, amsthm, amssymb, amsfonts}
\usepackage{url}

\begin{document}
\title{Хрупкость мотива по отношению к мутационному процессу}
\author{Воронцов И.Е.}
\maketitle
Мы рассмотрим мутационный процесс, вносящий однонуклеотидные замены, действующий на (ансамбле) всех сайтов, задаваемых мотивом. В качестве модели мотива мы используем матрицу частот $M^i_{\alpha_i}$. Строго говоря, мы не ограничиваемся мотивами сайтов связывания; это могут быть и сайты другой природы.
\section{Мотив}
По построению матрицы частот (и при условии независимости отдельных позиций) $$P(w | w \text{ is a site}) = \prod_{i=1}^n M^i_{w_i}$$
Фактически, матрица частот описывает всё множество сайтов и показывает, какой сайт там встречается с какой частотой.

Введём также вероятность того, что тринуклеотидный контекст позиции $i$ в сайте будет $\alpha\beta\gamma$:
$$M^i_{\alpha\beta\gamma} = M^{i-1}_{\alpha}M^i_{\beta}M^{i+1}_{\gamma}$$

\section{Мутационный процесс}
В нашей модели мутационный процесс $f_{\alpha\beta\gamma}^{\delta}$ задаётся мутационной подписью, т.е. распределением частот тринуклеотидных мутаций $\alpha\beta\gamma\to\alpha\delta\gamma$ (или кратко $\alpha\beta\gamma\to\delta$).

Мы полагаем, что мутационный процесс не может сохранить нуклеотид (этот случай мы рассматриваем отдельно как ``мутация не произошла''):
$$f_{\alpha\beta\gamma}^{\beta} = 0$$

Также мы полагаем, что мутации не имеют предпочтений по нити ДНК, так что
$$f_{\alpha\beta\gamma}^{\delta} = f_{\gamma'\beta'\alpha'}^{\delta'},$$
где $\alpha'$ - это нуклеотид, комплиментарный $\alpha$.

Мутационный процесс задаёт частоты, следовательно суммируется к единице:
$$\sum_{\alpha,\beta,\gamma,\delta} f_{\alpha\beta\gamma}^{\delta} = 1$$

\section{Действие мутационного процесса на ансамбль сайтов, характеризуемый мотивом}
Чтобы оценить влияние мутационного процесса на ансабль сайтов, мы построим (тоже в форме частотной матрицы) множество сайтов, каким оно будет при условии, что на исходное множество сайтов подействовал мутационный процесс. При этом мутации, внесенные в ансамбль, будут так распределены между различными позициями различных вариаций сайта, чтобы частоты тринуклеотидов были такими, как задаёт их мутационная подпись. 

Дополнительное условие, которое мы считаем выполняющимся: в одном и том же сайте не могло случиться две замены одновременно.

Изучим вероятность нуклеотида на фиксированной позиции после действия мутационного процесса быть $\delta$. Благодаря тому, что частоты нуклеотидов на различных позициях, независимы, нам достаточно рассматривать действие мутационного процесса локально - на определенной позиции с её тринуклеотидным контекстом. Необходимости перебирать все сайты для этого нет.

Рассмотрим следующее дерево исходов с условными вероятностями (при условии, что родительское условие выполнено):
\begin{itemize}
	\item с вероятностью $\rho$ cайт мутировал
	\begin{itemize}
		\item с вероятностью $f_{\alpha\beta\gamma}^{\delta}$ произошла мутация типа $\alpha\beta\gamma\to\delta$
		\begin{itemize}
			\item с вероятностью $\frac{M^i_{\alpha\beta\gamma}}{M_{\alpha\beta\gamma}} \equiv \frac{M^i_{\alpha\beta\gamma}}{\sum_i M^i_{\alpha\beta\gamma}}$ мутация в тринуклеотиде $\alpha\beta\gamma$ произошла именно на позиции $i$
		\end{itemize}
	\end{itemize}
	\item с вероятностью $(1-\rho)$ сайт вообще не мутировал
\end{itemize}

Для удобства мы обозначили сумму вероятностей встретить тринуклеотид $\alpha\beta\gamma$ на разных позициях сайта:
$$M_{\alpha\beta\gamma} = \sum_i M^i_{\alpha\beta\gamma}$$
Стоит отметить, что эта величина не является суммарной вероятностью встретить этот тринуклеотид на любой из позиций (более того, это вообще не вероятность; например, она может принимать значение больше единицы). Эта величина играет роль нормировочного множителя в ситуации, когда мутация ``выбирает'', какую позицию сайта она заденет.

Вычислим теперь вероятность получить нуклеотид $\delta$ в модели нового множества сайтов на $i$-ой позиции. Во-первых, выразим её как сумму вероятностей получить определенный контекст:
$$\widetilde{M}^i_{\delta} = \sum_{\alpha,\gamma}\widetilde{M}^i_{\alpha\delta\gamma}$$

Далее, вероятность получить нуклеотид $\delta$ складывается из вероятности того, что нуклеотид исходно был $\delta$ и не мутировал, а также вероятности того, что нуклеотид был неким $\beta$, но стал $\delta$. При этом мутация меняет позицию, если она попала в сайт (с вероятностью $\rho$), притом контекст мутации совпал с контекстом нуклеотида в сайте и эта мутация из всех мест с таким контекстом попала именно в нужную позицию. Не меняет позицию, соответственно, во всех других случаях.

Изменения фланкирующих нуклеотидов не играют роли при вычислении частоты встречаемости центрального нуклеотида, поскольку это лишь перераспределит вероятности получить различные контексты нуклеотида $\delta$. Сумма частот контекстов с фиксированным центром не изменится.

$$\widetilde{M}^i_{\alpha\delta\gamma} = \rho\sum_{\beta}M^i_{\alpha\beta\gamma}f_{\alpha\beta\gamma}^{\delta}\frac{M^i_{\alpha\beta\gamma}}{M_{\alpha\beta\gamma}} + M^i_{\alpha\delta\gamma}\left(1 - \rho\sum_{\xi}f_{\alpha\delta\gamma}^{\xi}\frac{M^i_{\alpha\delta\gamma}}{M_{\alpha\delta\gamma}}\right)$$

$$\Delta M^i_{\alpha\delta\gamma} = \widetilde{M}^i_{\alpha\delta\gamma} - M^i_{\alpha\delta\gamma}$$

$$\Delta M^i_{\alpha\delta\gamma}/\rho = \sum_{\beta}M^i_{\alpha\beta\gamma}f_{\alpha\beta\gamma}^{\delta}\frac{M^i_{\alpha\beta\gamma}}{M_{\alpha\beta\gamma}} - M^i_{\alpha\delta\gamma}\sum_{\xi}f_{\alpha\delta\gamma}^{\xi}\frac{M^i_{\alpha\delta\gamma}}{M_{\alpha\delta\gamma}}$$

$$\Delta M^i_{\delta} = \widetilde{M}^i_{\delta} - M^i_{\delta} = \sum_{\alpha,\gamma}\Delta M^i_{\alpha\delta\gamma}$$

$$\Delta M^i_{\delta}/\rho = \sum_{\alpha,\gamma}\left(\sum_{\beta}M^i_{\alpha\beta\gamma}f_{\alpha\beta\gamma}^{\delta}\frac{M^i_{\alpha\beta\gamma}}{M_{\alpha\beta\gamma}} - M^i_{\alpha\delta\gamma}\sum_{\xi}f_{\alpha\delta\gamma}^{\xi}\frac{M^i_{\alpha\delta\gamma}}{M_{\alpha\delta\gamma}}\right)$$

$$\Delta M^i_{\delta}/\rho = \sum_{\alpha,\gamma}\left(\sum_{\beta}\frac{\left(M^i_{\alpha\beta\gamma}\right)^2}{M_{\alpha\beta\gamma}}f_{\alpha\beta\gamma}^{\delta} - \frac{\left(M^i_{\alpha\delta\gamma}\right)^2}{M_{\alpha\delta\gamma}}\sum_{\xi}f_{\alpha\delta\gamma}^{\xi}\right)$$


Мы вычислили, в какую сторону и насколько сильно мутационный процесс будет перетягивать ансамбль сайтов. Если мы зафиксируем интенсивность мутационного процесса, положив $\rho=1$, мы можем применить метрики схожести мотивов для оценки того, насколько новое множество сайтов отличается от старого. Например, при помощи macro-ape мы можем вычислить Джаккарову похожесть множеств топовых слов. Это будет некая характеристика прочности (хрупкости) мотива против данной мутационной подписи.

\section{Дискуссия}

В методе явно предполагается, что мутационная подпись сайта нам задана. Но на практике мы знаем скорее полногеномную мутационную подпись. Нередко на ансамбле сайтов (особенно для консервативных мотивов) достигнуть заданной мутационной подписи не представляется возможным: в сайтах просто нет необходимых контекстов. Это отражается в том, что для некоторого набора $\alpha, \beta, \gamma$, стоящая в знаменателе сумма вероятностей встретить соответствующий контекст $M_{\alpha\beta\gamma} = 0$, тогда как частота мутаций $f_{\alpha\beta\gamma}^{\delta}\ne 0$.

Можно добавить фланки, содержащие равнораспределенные нуклеотиды - это позволит мутациям с нетипичными для сайта контекстами попадать во фланки. Остаётся однако не вполне ясным, как корректно сгенерировать фланки так, чтобы они моделировали полногеномное распределение тринуклеотидов.

Кроме того, стоит понять, не размывает ли добавление к мотиву фланок понятие интенсивности мутационного процесса $\rho$. Кажется, что нет: $\rho=1$ отвечает фактически ситуации, когда на каждый из $4^n$ сайтов приходится в среднем по одной мутации (но размазывается это общее количество по всему ансамблю, так что могут быть сайты, не имеющие мутации).

Ruby-cкрипт, применяющий мутационный процесс к частотной матрице вместе с тестовыми примерами можно найти в репозитории \url{https://github.com/VorontsovIE/motif_fragility}
\end{document}
